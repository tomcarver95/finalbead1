{"changed":true,"filter":false,"title":"error.js","tooltip":"/controllers/error.js","value":"\n// controllers/error.js\nvar express = require('express');\nvar router = express.Router();\n\nvar decorateErrors = require('../viewmodels/error');\n\n// Hibalista oldal\nrouter.get('/list', function (req, res) {\n    req.app.models.error.find().then(function (errors) {\n        res.render('errors/list', {\n            errors: decorateErrors(errors),\n            messages: req.flash('info')\n        });\n    });\n});\n\n// Hiba felvitele\nrouter.get('/new', function(req, res) {\n    var validationErrors = (req.flash('validationErrors') || [{}]).pop();\n    var data = (req.flash('data') || [{}]).pop();\n    \n    res.render('errors/new', {\n        validationErrors: validationErrors,\n        data: data,\n    });\n})\n\n// Hiba felvitele POST\nrouter.post('/new', function(req, res) {\n   // adatok ellenőrzése\n    req.checkBody('helyszin', 'Hibás helyszín').notEmpty().withMessage('Kötelező megadni!');\n    req.sanitizeBody('leiras').escape();\n    req.checkBody('leiras', 'Hibás leírás').notEmpty().withMessage('Kötelező megadni!');\n    \n    var validationErrors = req.validationErrors(true);\n    console.log(validationErrors);\n    \n    if (validationErrors) {\n        // űrlap megjelenítése a hibákkal és a felküldött adatokkal\n        req.flash('validationErrors', validationErrors);\n        req.flash('data', req.body);\n        res.redirect('/errors/new');\n    }\n    else {\n        req.app.models.error.create({\n            status: 'new',\n            location: req.body.helyszin,\n            description: req.body.leiras\n        })\n        .then(function (error) {\n            //siker\n            req.flash('info', 'Hiba sikeresen felvéve!');\n            res.redirect('/errors/list');\n        })\n        .catch(function (err) {\n            //hiba\n            console.log(err)\n        });\n    }\n})\n\nmodule.exports = router;\n\n","undoManager":{"mark":1,"position":6,"stack":[[{"start":{"row":10,"column":0},"end":{"row":10,"column":28},"action":"remove","lines":["        console.log(errors);"],"id":2}],[{"start":{"row":10,"column":0},"end":{"row":11,"column":0},"action":"remove","lines":["",""],"id":3}],[{"start":{"row":10,"column":35},"end":{"row":11,"column":0},"action":"insert","lines":["",""],"id":4},{"start":{"row":11,"column":0},"end":{"row":11,"column":12},"action":"insert","lines":["            "]}],[{"start":{"row":11,"column":12},"end":{"row":11,"column":50},"action":"insert","lines":["scripts: ['script1.js', 'script2.js'],"],"id":5}],[{"start":{"row":11,"column":23},"end":{"row":11,"column":24},"action":"insert","lines":[" "],"id":6}],[{"start":{"row":11,"column":0},"end":{"row":11,"column":51},"action":"remove","lines":["            scripts: [' script1.js', 'script2.js'],"],"id":7}],[{"start":{"row":11,"column":0},"end":{"row":12,"column":0},"action":"remove","lines":["",""],"id":8}]]},"ace":{"folds":[],"scrolltop":0,"scrollleft":0,"selection":{"start":{"row":14,"column":7},"end":{"row":14,"column":7},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":{"row":33,"state":"start","mode":"ace/mode/javascript"}},"timestamp":1445466821642}