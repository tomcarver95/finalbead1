{"filter":false,"title":"user.test.js","tooltip":"/models/user.test.js","undoManager":{"mark":2,"position":2,"stack":[[{"start":{"row":0,"column":0},"end":{"row":87,"column":3},"action":"insert","lines":["var expect = require(\"chai\").expect;","var bcrypt = require('bcryptjs');","","var Waterline = require('waterline');","var waterlineConfig = require('../config/waterline');","var userCollection = require('./user');","var errorCollection = require('./error');","","var User;","","before(function (done) {","    // ORM indítása","    var orm = new Waterline();","","    orm.loadCollection(Waterline.Collection.extend(userCollection));","    orm.loadCollection(Waterline.Collection.extend(errorCollection));","    waterlineConfig.connections.default.adapter = 'memory';","","    orm.initialize(waterlineConfig, function(err, models) {","        if(err) throw err;","        User = models.collections.user;","        done();","    });","});","","describe('UserModel', function () {","","    function getUserData() {","        return {","            neptun: 'abcdef',","            password: 'jelszo',","            surname: 'Gipsz',","            forename: 'Jakab',","            avatar: '',","        };","    }","","    beforeEach(function (done) {","        User.destroy({}, function (err) {","            done();","        });","    });","    ","    it('should be able to create a user', function () {","        return User.create({","                neptun: 'abcdef',","                password: 'jelszo',","                surname: 'Gipsz',","                forename: 'Jakab',","                avatar: '',","        })","        .then(function (user) {","            expect(user.neptun).to.equal('abcdef');","            expect(bcrypt.compareSync('jelszo', user.password)).to.be.true;","            expect(user.surname).to.equal('Gipsz');","            expect(user.forename).to.equal('Jakab');","            expect(user.avatar).to.equal('');","        });","    });","","    it('should be able to find a user', function() {","        return User.create(getUserData())","        .then(function(user) {","            return User.findOneByNeptun(user.neptun);","        })","        .then(function (user) {","            expect(user.neptun).to.equal('abcdef');","            expect(bcrypt.compareSync('jelszo', user.password)).to.be.true;","            expect(user.surname).to.equal('Gipsz');","            expect(user.forename).to.equal('Jakab');","            expect(user.avatar).to.equal('');","        });","    });","","    describe('#validPassword', function() {","        it('should return true with right password', function() {","             return User.create(getUserData()).then(function(user) {","                 expect(user.validPassword('jelszo')).to.be.true;","             })","        });","        it('should return false with wrong password', function() {","             return User.create(getUserData()).then(function(user) {","                 expect(user.validPassword('titkos')).to.be.false;","             })","        });","    });","","});"],"id":1}],[{"start":{"row":87,"column":3},"end":{"row":88,"column":0},"action":"insert","lines":["",""],"id":2}],[{"start":{"row":0,"column":0},"end":{"row":1,"column":0},"action":"insert","lines":["",""],"id":3}]]},"ace":{"folds":[],"scrolltop":0,"scrollleft":0,"selection":{"start":{"row":1,"column":0},"end":{"row":1,"column":0},"isBackwards":true},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":0},"timestamp":1445463848734,"hash":"396a22560d155ef436b1b547bc2fe8a033d9e4d8"}